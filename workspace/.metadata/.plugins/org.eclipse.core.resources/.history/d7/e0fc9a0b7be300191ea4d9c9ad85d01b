package me.Arouraios.Crystal.minigame;

import java.util.Timer;
import java.util.TimerTask;
import java.util.logging.Logger;

import org.bukkit.Server;
import org.bukkit.configuration.file.FileConfiguration;

import me.Arouraios.Crystal.utils.Commander;
import me.Arouraios.Crystal.utils.CountDown;
import me.Arouraios.Crystal.utils.Player;
import me.Arouraios.Crystal.worlds.WorldManager;

public class Game implements Runnable{
	private Thread t;
	private String count;
	private Logger log;
	@SuppressWarnings("unused")
	private FileConfiguration conf;
	private WorldManager WM;
	private Server serv;
	private Commander C;
	private String status;
	
	public Game(String gameCount, Logger pLog, FileConfiguration pConf, WorldManager pWM, Server pServ, Commander pC) {
		count=gameCount;
		log=pLog;
		conf=pConf;
		WM=pWM;
		serv=pServ;
		C=pC;
		status = "new";
		t = new Thread(this, count);
		t.run();
		log.info("game " + count + " started running");
	}
	
	public void run() {
		//create Teams/initialize TeamMaster
		
		play();
	}
	
	private void play() {
		while(true) {
			switch (status) {
			case "new":
				loadLobby();
				CountDown.main(serv, this, 30);
				status="lobby";
				break;
			case "lobby":
				break;
			case "loadgame":
				loadGame();
				CountDown.main(serv, this, 120);
				break;
			case "game":
				break;
			case "end":
				C.tpallto(0,0,0, "world");
				break;
			}
		}
	}
	
	private void loadGame() {
		WM.copyBackup("miniWorld" + count);
		WM.loadWorld("miniWorld" + count);
		C.tpallto(0,150,0, "miniWorld" + count);
	}
	
	private void loadLobby() {
		WM.loadWorld("miniWorldLobby" + count);
		log.info("all players will be teleported to the new game-lobby in 10 seconds");
		Timer timer = new Timer();
		TimerTask task = new TimerTask() {
			@Override
			public void run() {
				C.tpallto(0,150,0,"miniWorldLobby" + count);
			}
		};
		timer.schedule(task, 0, 1000);
	}
	
	public String getCount() {
		return count;
	}
	
	public Thread getThread() {
		return t;
	}

	public void timerEnded() {
		switch (status) {
		case "lobby":
			status="loadgame";
			break;
		case "game":
			status="end";
			break;
		}
		
	}

	public String getWorld() {
		return "miniWorld0";
	}
}
